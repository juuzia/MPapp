<head>
    <style>
        .fa-solid{
            color: lightseagreen;
            background-color: lightcoral;
        }
        .owl-stage, .owl-carousel, .owl-stage-outer {
            width: 1px !important;
        }
       .item{
        background-color: #4DC7A0;
  color: white;
  font-size: 30px;

  padding: 10px;
       }
      



    </style>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<scripts>
 

</scripts>



{% macro fastq_uploader() -%}

    <div class="card border-dark">
        <div class="card-header bg-dark text-white text-center">
            FASTQ input
        </div>
        <div class="card-body">
            <p class="card-text">
                
            </p>
            <form method="post" enctype=multipart/form-data>
                <div class="form-group pt-2">
                    <label for="file1"><b>FASTQ file 1:</b></label>
                    <input type="file" name="file1" class="form-control-file" id="file1">
                    <hr>
                    <label for="file2"><b>FASTQ file 2:</b></label>
                    <input type="file" name="file2" class="form-control-file" id="file2">
                </div>
                <hr>
                <div class="justify-content-center text-center">
                    <button type="submit" class="btn btn-success btn-lg" name="fastq_submit" id="fastq_submit" onclick="$('#loading').show();">Submit</button>
                </div>
            </form>
        </div>https://github.com/jodyphelan/jodyphelan.github.io
    </div>

{%- endmacro %}

{% macro bam_uploader() -%}

    <div class="card border-dark">
        <div class="card-header bg-dark text-white text-center">
            BAM input
        </div>
        <div class="card-body">
            <p class="card-text">
   
            </p>
            <form method="post" enctype=multipart/form-data>
                <div class="form-group pt-2">
                    <label for="bam"><b>Upload file:</b></label>
                    <input type="file" name="bam" class="form-control-file" id="bam">
                </div>
                <hr>
                <div class="justify-content-center text-center">
                    <button type="submit" class="btn btn-success btn-lg" name="bam_submit" id="bam_submit">Submit</button>
                </div>
            </form>
        </div>
    </div>

{%- endmacro %}

{% macro file_dropper(random_id) -%}

    <div class="drop-section">
        
        <div class="body">
            <p class="text">
                Please drop your files in here and click submit when done.
                
            </p>
            <form method="POST" action='{{ url_for("main.file_upload",upload_id=random_id) }}' class="dropzone dz-clickable" 
                id="dropper" enctype="multipart/form-data">
                <div class="dz-message" data-dz-message> <i class="fa fa-upload fa-6x" aria-hidden="true"></i></div>
               
            </form>
            <form method="post">
                <div class="row justify-content-center text-center">
                    
                    <div class="form-check" style="margin-right: 50px;">
                        <input class="form-check-input" type="radio" name="radio_platform" id="radiobtn_illumina" value="illumina" checked>
                        <label class="form-check-label" for="radiobtn_illumina">Illumina</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="radio_platform" id="radiobtn_nanopore" value="nanopore">
                        <label class="form-check-label" for="radiobtn_nanopore">Nanopore</label>
                    </div>
                </div>
                <hr> 
                <div class="pt-2 justify-content-center text-center">
                    <button type="submit" class="btn btn-outline-success btn-lg" name="submit_button" value="{{random_id}}" id="bam_submit">SUBMIT</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.7.1/min/dropzone.min.js"></script>

    <script type="application/javascript">
        Dropzone.options.dropper = {
            paramName: 'file',
            chunking: true,
            forceChunking: true,
            url: '{{ url_for("main.file_upload", upload_id=random_id) }}',
            maxFilesize: 5000, // megabytes
            chunkSize: 100000000, // bytes
            timeout: 0
        }	
    </script>

{%- endmacro %}


{% macro result_retriever() -%}
<main style="margin-top: 10%;">
    <div class="header">
        <h1 class="header">
            Get results
        </h1>
        <div class="text-align">
            <div class="row justify-content-center">
                <p class="justify-content-center">
                    Find your results by entering your unique <b>Result ID</b> into
                    the search box below.
                </p>
            </div>
            <form method="post" enctype=multipart/form-data>
                <div class="row justify-content-center text-center">                
                    <div class=" tags-input">
                        <input type="text" name="result_id" class="form-control no-border shadow-none"  placeholder="Result ID">
                    </div>
                </div>
                <hr>
                <div class="justify-content-center text-center">
                    <button type="submit" id="result_submit" name="result_submit", class="btn btn-outline-success btn-lg">SUBMIT</button>
                </div>
            </form>
        </div>
    </div>
</main>
{%- endmacro %}

{% macro description() -%}

<div class="text-align">
    <div class="header">
        
    </div>
    <hr>
    <div class="body">
        <p class="text">
            For the analysis you can upload multiple <b>fastq</b> or <b>bam</b> files below. In the single run all uploaded data should be from the same platform - Illumina or Nanopore.
            
            During upload, each sample will be assigned a unique <b>Result ID</b> that is required to retrieve the corresponding result.
            After submitting, logfile with all <b>Result IDs</b> and sample name pairs will be automatically downloaded.
        </p>
    </div>
</div>
{%- endmacro %}




{% macro generic_table(rows, columns, name) -%}

{% set rand_id = range(1, 5000) | random %}
<div class=" " style="height: inherit;">
    
    <div class="card-body">
        <table class="table table-hover" id="table-{{rand_id}}">
            <thead>
                <tr>
                    <th scope="col" style="width: 10%">Drug</th>    
                    <th scope="col" style="width: 30%">Mutations</th>
                </tr>
            </thead>
            <tbody id="resultsTable">
                {% for row in rows %}
                {% set my_counter = loop.index %}
                    <tr>
                    {% for key in columns %}
                    {% if key != 'Genotypic Resistance' %}
                    {% if row[key] == "Chloroquine" or row[key] == "Mefloquine" or row[key] == "Pyrimethamine" or row[key] == "Sulfadoxine" or row[key] == "Artemisinin"  %}
                    
                    <td>
                        {{ row[key]|safe }}
                    </td>
                    {% else %}
                    
                    

                        <td>
                            <button type="button" id="dropdownMenu{{my_counter}}" class="btn btn-outline-success dropdown-toggle" data-toggle="dropdown" aria-expanded="false" >
                                SELECT MUTATION
                              </button>
                              <div class="dropdown-menu" aria-labelledby="dropdownMenu{{my_counter}}">
                                {% set row = row[key]|string %}
                                {% for item in row.split(',') %}
                                
                                  <div  class="dropdown-item " onclick="showGene(this,{{my_counter}})" data-value={{ item|safe }}>
                                    {{ item|safe }}
                                </div>
                                {% endfor %}
                              </div>
                              <a  class="btn btn-outline-success" onclick="showGene2({{my_counter}})" >VIEW IN IGV</a>
                              
                            </td>
                        {% endif %}
                        {% endif %}
                        
                    {% endfor %}
                    
                    </tr>
                {% endfor %} 
                
            </tbody>

        </table>
    </div>
</div>

{%- endmacro %}

{% macro get_results(rows, columns, name) -%}
<div class="container">
    
    {% for row in rows %}
    
    {% for key in columns %}
    
    {% if row[key] == 'falciparum' %}
    <i class="fa-solid fa-p fa-6x"></i>
    <i class="fa-solid fa-f fa-3x"></i>
    {% elif row[key] == 'ovale' %}
    <i class="fa-solid fa-p fa-6x"></i>
    <i class="fa-solid fa-o fa-3x"></i>
    {% elif row[key] == 'vivax' %}
    <i class="fa-solid fa-p fa-6x"></i>
    <i class="fa-solid fa-v fa-3x"></i>
    {% elif row[key] == 'knowlesi' %}
    <i class="fa-solid fa-p fa-6x"></i>
    <i class="fa-solid fa-k fa-3x"></i>
    {% elif row[key] == 'brasilianum' %}
    <i class="fa-solid fa-p fa-6x"></i>
    <i class="fa-solid fa-b fa-3x"></i>
    {% else %}
    
    
            {% endif %}
        {% endfor %}
    {% endfor %}

    <table class="table table-hover" id="table-{{rand_id}}">
        <thead>
            <tr>
                {% for key in columns %}
                {% if columns[key] != "Species" %}
                    <th scope="col" style="width: 10%">{{ columns[key] }}</th>
                    {% endif %}
                    {% endfor %}
            </tr>
        </thead>
        <tbody id="resultsTable">
            {% for row in rows %}
                <tr>
                {% for key in columns %}
                {% if row[key] != 'falciparum' %}
                    <td>
                        {{ row[key]|safe }}
                    </td>
                    {% endif %}
                {% endfor %}
                </tr>
            {% endfor %}                
        </tbody>
    </table>
                  

</div>
{%- endmacro %}


{% macro get_results2(rows, columns, name) -%}
<div class="contasiner">
 {% for row in rows %}
  {% for key in columns %}
      {% if not '-' in row[key] %}
      <p style="">{{ row[key] }}</p>
         
     {% else %} 
    
    {% endif %}      
    {% endfor %}

{% endfor %}                

</div>
{%- endmacro %}

{% macro get_analysis(rows, columns, name) -%}

<div class="owl-carousel">{% set values = [] %}
    {% for row in rows %}
                    {% for key in columns %}
                    {{values.append(row[key]) or ""}}
                    {% if loop.index0 == 3 %}
    <div class="item">

        <table class="table table-hover" id="table-{{rand_id}}">
                <thead>
                <tr>
                    <th scope="col" style="width: 10%;">Gene</th>   
                    <th scope="col" style="width: 10%;">Locus Tag</th>   
                    <th scope="col" style="width: 10%;">Cutoff</th>   
                    <th scope="col" style="width: 10%;">Fraction</th>   
                </tr>
            </thead>
                
                    
            <tbody id="resultsTable">
                    
                <tr>
                    <td class="col-md-2" >
                        {{ values[0]}}
                    </td>
                    <td class="col-md-2">
                        {{ values[1]}}
                    </td class="col-md-2">
                    <td>
                    {{ values[2]}}
                    </td >
                    <td class="col-md-2">
                    {{ values[3]}}
                    </td>
                </tr>
                   
                    {{values.clear() or ""}}
                   
                    
        
        
                </tbody>
            </table>
            
        </div>
        {% endif %}
        {% endfor %}    
                {% endfor %}
       
            
      </div>
        
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.theme.default.css"></script>
    <script>
       $(document).ready(function() {
        $(".owl-carousel").owlCarousel({
            loop:true,
            autoplay:true,
    autoplayTimeout:2000,
    autoplayHoverPause:true, 
            margin:10,
            dots:true,
            
            items: 1,
            singleItem:true,
            
                   });
                });

    </script>
{%- endmacro %}

</div>   
    
