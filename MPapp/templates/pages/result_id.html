{% import 'macros.html' as macros %}
{% extends "base.html" %}
{% block header %}
{% endblock %}
{% block content %}
{% if status == "OK" %}
<head>
  <scripts>
    
<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.js"></script>
<script>


function setup() {
    var canvasDiv = document.getElementById('canvasForHTML');
    var width = canvasDiv.offsetWidth;
    var sketchCanvas = createCanvas(width/1.5,height);
    
    sketchCanvas.parent("canvasForHTML");
} 
function draw() {
 
  rect(100, 10, width/1.5,height/2, 25);
  
}


</script>
    
    <script type="text/javascript">
      am5.ready(function() {


var root = am5.Root.new("chartdiv");


root.setThemes([
  am5themes_Animated.new(root)
]);


var chart = root.container.children.push(am5map.MapChart.new(root, {
  panX: "rotateX",
  panY: "rotateY",
  projection: am5map.geoOrthographic(),
  paddingBottom: 20,
  paddingTop: 20,
  paddingLeft: 20,
  paddingRight: 20
}));

var cont = chart.children.push(
  am5.Container.new(root, {
    layout: root.horizontalLayout,
    x: 20,
    y: 40
  })
);


var backgroundSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {}));
backgroundSeries.mapPolygons.template.setAll({
  fill: root.interfaceColors.get("alternativeBackground"),
  fillOpacity: 0,
  strokeOpacity: 0
});
backgroundSeries.mapPolygons.template.set("fillOpacity", 0);

backgroundSeries.data.push({
  geometry: am5map.getGeoRectangle(90, 180, -90, -180)
});

// Create main polygon series for countries

var polygonSeries = chart.series.push(
  am5map.MapPolygonSeries.new(root, {
    geoJSON: am5geodata_worldLow,
    exclude: ["antarctica"],
  })
);


var lineSeries = chart.series.push(am5map.MapLineSeries.new(root, {}));
lineSeries.mapLines.template.setAll({
  stroke: root.interfaceColors.get("alternativeBackground"),
  strokeOpacity: 0.3
});


var pointSeries = chart.series.push(am5map.MapPointSeries.new(root, {}));
var colorset = am5.ColorSet.new(root, {});

pointSeries.bullets.push(function () {
  var container = am5.Container.new(root, {});

  var circle = container.children.push(
    am5.Circle.new(root, {
      radius: 6,
      tooltipY: 0,
      fill: am5.color(0xff0000),
      strokeOpacity: 0,
      tooltipText: "{title}"
    })
  );

  var circle2 = container.children.push(
    am5.Circle.new(root, {
      radius:12,
      tooltipY: 0,
      fill: am5.color(0xff0000),
      strokeOpacity: 0,
      tooltipText: "{title}"
    })
  );

  circle.animate({
    key: "scale",
    from: 1,
    to: 4,
    duration: 600,
    easing: am5.ease.out(am5.ease.cubic),
    loops: Infinity
  });
  circle.animate({
    key: "opacity",
    from: 1,
    to: 0,
    duration: 3000,
    easing: am5.ease.out(am5.ease.cubic),
    loops: Infinity
  });

  return am5.Bullet.new(root, {
    sprite: container
  });
});

var regions = [
  {
    title: "West Africa",
    latitude: 9,
    longitude: 4
  },
  
];

for (var i = 0; i < regions.length; i++) {
  var region = regions[i];
  addregion(region.longitude, region.latitude, region.title);
}

function addregion(longitude, latitude, title) {
  pointSeries.data.push({
    geometry: { type: "Point", coordinates: [longitude, latitude] },
    title: title
  });
}


chart.appear(1000, 100);


}); 

    </script>
   
  </scripts>
  <style>

div#draw-shapes {
  width: 95%;
  height: 600px;
  margin: 2.5% auto;
}
    body{
      background-color: #eee;
    }
    .container-fluid {
   height: 100vh;
   width: 99%;
   background-color: #eee;
   display: grid;
   
  gap:5px ;
   grid-template-columns: repeat(4, 1fr);
   grid-template-rows: repeat(4, 1fr);
   
   

}
.container-fluid > div{
  box-shadow: 2px 2px 5px #333;
  padding: 20px;
 
  background-color: white;
}
.container-fluid > div:nth-child(1){
  
  grid-column: span 4;
  height: 100px;
  
}
.container-fluid > div:nth-child(2){
  height: 300px;
  grid-column: span 1;
  text-align: center;
}

.container-fluid > div:nth-child(3){
  
  grid-column: span 2;
  grid-row: span 2;
}
.container-fluid > div:nth-child(4){
  
  grid-column: span 1;
}
.container-fluid > div:nth-child(5){
  
  grid-column: span 1;
}
.container-fluid > div:nth-child(6){
  height: 300px;
  grid-column: span 1;
}
.container-fluid > div:nth-child(7){
  height: 210px;
  grid-column: span 4;
}
.container-fluid .fa-solid{
            color: lightseagreen;
            margin-top: 5px;
        }
        
  </style>
  <script type="text/javascript">
$(document).ready(function(){
  var djangoData = $('#my-data').data();

console.log(djangoData)

$('#7').on('click', function(e) {  
    
});
});
  </script>
</head>
<div class="container-fluid">
  <div class="1">
    <h4><b>Result ID:</b> {{run_id}}</h4>
    <div class="date">
      {% for key in tables %}
      {% if key == 'General information' %}
      {{macros.get_results2(tables[key][0], tables[key][1], key)}}
      
      {% endif %}
      {% endfor %}              
    </div>
    <div class="id">
      <form method="get" action="{{ url_for('main.download', run_id=run_id) }}">          
      <button type="submit" class="btn btn-success btn" name="result_download" id="result_download"><i class="fa fa-download"></i> Download</button>
          
    </div>
  </div>
  
  <div class="2">
    
    {% for key in tables %}
    {% if key == 'Species' %}
    {{macros.get_results(tables[key][0], tables[key][1], key)}}
    
    {% endif %}
    {% endfor %}                 
  </div>
  <div class="3">
    <div class="row justify-content-center text-center">
      <div class="col-md-6">    
        <div class="tab-content" id="tabcontent">  
          
          {% for key in tables %}     
            
              {% set keyname = key.replace(' ', '') %}
                {% if key == "Resistance report" %}
                <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                </div>       
            
                <div class="tab-pane fade" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                </div>  
            {% endif %}
          {% endfor %}
        </div>
      </div>    
    </div>
  </div>
  <div class="4">
    <div class="card-header text-center bg-dark text-white">
      <h5>Region of Origin</h5>
  </div>
    <div id="chartdiv" style="width: 100%; height: 75%;"></div></div>
  <div class="5">
    {% for key in tables %}
    {% if key == 'Analysis' %}
    {{macros.get_results(tables[key][0], tables[key][1], key)}}
    
    {% endif %}
    {% endfor %}  
  </div>
  <div class="6">{% for key in tables %}
    {% if key == 'Coverage report' %}
    {{macros.get_results(tables[key][0], tables[key][1], key)}}
    
    {% endif %}
    {% endfor %} </div>
  <div  class="7" id="7">
    {% for key in tables %}
    
    {% for row in tables[key][0] %}
    
    <meta id="my-data" data-name="{{row}}" >
    
    {% endfor %}
    {% endfor %}
    <div  id="canvasForHTML" style="margin-top: 70px;"></div>
</div>

  
</div>
<!--
  <div class="row justify-content-center text-center">
    <div class="col-md-6">
      <h4><b>Result ID:</b> {{run_id}}</h4>
        <div id="f3" class="row justify-content-center">
          <form method="get" action="{{ url_for('main.download', run_id=run_id) }}">          
          <button type="submit" class="btn btn-success btn-lg" name="result_download" id="result_download"><i class="fa fa-download"></i> Download</button>
          </form>
        </div>
        <hr>  
    </div>
  </div class="row justify-content-center text-center">
  
  <div class="row justify-content-center text-center">
    <div class="col-md-6">
      <ul class="nav nav-tabs" id="nav-tab" role="tablist">
        {% for key in tables %}
          {% if tables[key] != None %}
            {% set keyname = key.replace(' ', '') %}
              <li class="nav-item" role="presentation">
                {% if loop.index0 == 0 %}                    
                  <a class="nav-link active" id="{{ keyname }}-tab" data-toggle="tab" href="#{{ keyname }}-tabs" role="tab" aria-controls="{{ keyname }}-tabs" aria-selected="true">{{key}}</a>
                {% else %}
                  <a class="nav-link" id="{{ keyname }}-tab" data-toggle="tab" href="#{{ keyname }}-tabs" role="tab" aria-controls="{{ keyname }}-tabs" aria-selected="false">{{key}}</a>
                {% endif %}
              </li>
          {% endif %}            
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="row justify-content-center text-center">
    <div class="col-md-6">    
      <div class="tab-content" id="tabcontent">  
        {% for key in tables %}     
          {% if tables[key] != None %}         
            {% set keyname = key.replace(' ', '') %}
            {% if loop.index0 == 0 %}  
              <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                {{macros.generic_table(tables[key][0], tables[key][1], key)}}
              </div>       
            {% elif loop.index0 != 0 %}
              <div class="tab-pane fade" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                {{macros.generic_table(tables[key][0], tables[key][1], key)}}
              </div>  
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>    
  </div>
  
{% elif status == "Processing" %}
  <div class="row justify-content-center">
    <div class="loader"></div>
  </div>
  <div class="row justify-content-center">
    <h4 id="resultid">{{run_id}}</h4>

  -->
  <script>

    setTimeout(function(){
        window.location.reload(1);
    }, 5000);
  </script> 

{% endif %}
{% endblock %}