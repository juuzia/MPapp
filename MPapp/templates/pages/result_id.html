{% import 'macros.html' as macros %}
{% extends "base.html" %}
{% block header %}
{% endblock %}
{% block content %}
{% if status == "OK" %}
<head>
  <scripts>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Sofia+Sans:wght@300&display=swap" rel="stylesheet">
<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/map.js"></script>
<script src="https://cdn.amcharts.com/lib/5/geodata/worldLow.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" integrity="sha512-tS3S5qG0BlhnQROyJXvNjeEM4UpMXHrQfTGmbQ1gKmelCxlSEBUaxhRBj/EFTzpbP4RVSrpEikbmdJobCvhE3g==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw==" crossorigin="anonymous"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>


<script src="https://cdn.jsdelivr.net/npm/igv@2.13.9/dist/igv.min.js"></script>

    
    <script type="text/javascript">
      am5.ready(function() {


var root = am5.Root.new("chartdiv");


root.setThemes([
  am5themes_Animated.new(root)
]);


var chart = root.container.children.push(am5map.MapChart.new(root, {
  panX: "rotateX",
  panY: "rotateY",
  projection: am5map.geoOrthographic(),
  paddingBottom: 20,
  paddingTop: 20,
  paddingLeft: 20,
  paddingRight: 20
}));

var cont = chart.children.push(
  am5.Container.new(root, {
    layout: root.horizontalLayout,
    x: 20,
    y: 40
  })
);


var backgroundSeries = chart.series.push(am5map.MapPolygonSeries.new(root, {}));

backgroundSeries.mapPolygons.template.setAll({
  fill: am5.color("#2B65EC"),
  fillOpacity: 0.5,
  strokeOpacity: 0
});
backgroundSeries.data.push({
  geometry:
    am5map.getGeoRectangle(90, 180, -90, -180)
});
// Create main polygon series for countries

var polygonSeries = chart.series.push(
  am5map.MapPolygonSeries.new(root, {
    geoJSON: am5geodata_worldLow,
   
  })
);

polygonSeries.mapPolygons.template.setAll({
  fill: am5.color("#eee"),
  
  strokeWidth: 0.5,
  stroke: root.interfaceColors.get("background")
});



var pointSeries = chart.series.push(am5map.MapPointSeries.new(root, {}));
var colorset = am5.ColorSet.new(root, {});

pointSeries.bullets.push(function () {
  var container = am5.Container.new(root, {});

  var circle = container.children.push(
    am5.Circle.new(root, {
      radius: 8,
      tooltipY: 0,
      fill: am5.color(0xff0000),
      strokeOpacity: 0,
      tooltipText: "{title}"
    })
  );

  var circle2 = container.children.push(
    am5.Circle.new(root, {
      radius:14,
      tooltipY: 0,
      fill: am5.color(0xff0000),
      strokeOpacity: 0,
      tooltipText: "{title}"
    })
  );

  circle.animate({
    key: "scale",
    from: 1,
    to: 4,
    duration: 600,
    easing: am5.ease.out(am5.ease.cubic),
    loops: Infinity
  });
  circle.animate({
    key: "opacity",
    from: 1,
    to: 0,
    duration: 3000,
    easing: am5.ease.out(am5.ease.cubic),
    loops: Infinity
  });

  return am5.Bullet.new(root, {
    sprite: container
  });
});

var regions = [
  
  
];

// Rotate animation
chart.animate({
  key: "rotationX",
  from: 0,
  to: 360,
  duration: 6000,
  loops: Infinity
});
$(document).ready(function(){
 
 
  var region = $('#region').data();
var regionalValues = Object.values(region);

firstValue = regionalValues[0]
var splitValues = firstValue.split(":")
beforeTrim = splitValues[1];
finalRegion = beforeTrim.replace(/[^\w\s!?]/g,'');

if(finalRegion == " Western Africa" ){
regions.push({
    title: "West Africa",
    latitude: 13,
    longitude: 2
  },)
  
  
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}else if (finalRegion == " Oceania"){

  regions.push({
    title: "Oceania",
    latitude:-15,
    longitude: 140
  },)
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}else if (finalRegion == " Eastern Africa"){
  regions.push({
    title: "East Africa",
    latitude: 14,
    longitude: 33
  },)
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}else if (finalRegion == " Africa"){
  regions.push({
    title: "Africa",
    latitude: 6.6,
    longitude: 21
  },)
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}else if (finalRegion == " Southeast Asia"){
  regions.push({
    title: "Southeast Asia",
    latitude: 7,
    longitude: 111
  },)
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}else if (finalRegion == " Horn of Africa"){
  regions.push({
    title: "Horn of Africa",
    latitude: 7,
    longitude: 43
  },)
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}else if (finalRegion == " South America"){
  regions.push({
    title: "South America",
    latitude: -10,
    longitude: -60
  },)
  addregion(regions[0].longitude, regions[0].latitude, regions[0].title);
  
}
})


function addregion(longitude, latitude, title) {
  pointSeries.data.push({
    geometry: { type: "Point", coordinates: [longitude, latitude] },
    title: title
  });
}


chart.appear(1000, 100);


}); 

    </script>
   
  </scripts>
  <style>
#table-{
  text-align: left;
}
div#draw-shapes {
  width: 95%;
  height: 600px;
  margin: 2.5% auto;
}
    body{
      background-color: RGB(240,240,240)
    }
    

#desktop_dashboard .container-fluid > div{
  box-shadow: 2px 2px 10px ;
  height: auto;
 border-radius: 15px;
  background-color: white;
  
}
.container-fluid > div:nth-child(1){
  padding:20px;
  grid-column: span 4;
  
  font-family: Georgia, 'Times New Roman', Times, serif;

}
.container-fluid > div:nth-child(1) .buttonHere,h4,.date{
  
  display: flex;
  
  justify-content: center; /* center horizontal */
  align-items: center; /* center vertical */
  font-family:'Sofia Sans', sans-serif;
}

 .header{
  border-radius: 15px;
}
.container-fluid > div:nth-child(2){
  
  grid-column: span 1;
  text-align: center;
}

.container-fluid > div:nth-child(3){
  
  grid-column: span 2;
  grid-row: span 2;
}
.container-fluid > div:nth-child(4){
  
  grid-column: span 1;
}
.container-fluid > div:nth-child(5){
  
  grid-column: span 1;
}
.container-fluid > div:nth-child(6){
  
  grid-column: span 1;
  overflow: hidden;
}
.container-fluid > div:nth-child(7){
 
  grid-column: span 4;
  
}
.container-fluid .fa-solid{
            color: rgb(255,89,0);
            margin-top: 5px;
        }

.container2 {
  height: 40%;
  width: 100%;
  display: flex;
  flex-direction: row;
 
}
        .container2 > div:nth-child(1){
  width:80%;
  height: 70%;
  
 
}
.container2 > div:nth-child(2){
  width:80%;
  height: 70%;
  
  margin: 10px;
  
}
.container2 > div:nth-child(3){
  width:80%;
  height: 70%;
  grid-column-start: 1;
  grid-row-start: 3;
 
  margin: 10px;
}
.container2 > div:nth-child(4){
  width:80%;
  height: 70%;
  flex-direction: column;
  margin: 10px;
}
.container3{
  clear: both;
  display: flex;
  flex-direction: column;
  
}
.container4{
  clear: both;
  display: flex;
  float:left;
  width:33%;
  height: inherit;
  flex-direction: column;
}


.resistance .btn-outline-success{
  justify-content: center;
  align-items: center;
  text-align: center;
  font-family: 'Sofia Sans', sans-serif;;
}
.buttonHere{
  display: flex;
  
  justify-content: center; /* center horizontal */
  align-items: center; /* center vertical */
  overflow: hidden;
  width: inherit;
}
.container .btn{
  background-color: rgb(255,89,0);
  border-color: rgb(255,89,0);
  width:50%;
  font-family: 'Sofia Sans', sans-serif;;

}
.item{
width:inherit;
  text-align: center;
}
table {
    table-layout: fixed;
    overflow-y: scroll;
    word-wrap: break-word;
}
.dropdown-menu {
  color: white !important;
  background-color: rgb(74,74,74) !important;
  }

.dropdown-item{
  color: white;
}
#remove2,#remove1,#remove3{
  overflow-y:  scroll;
}
#desktop_dashboard .tabby{
max-height: 400px;
}

.text-center p{
  font-family: 'Sofia Sans', sans-serif;
}
.generic_table .card-header,.rtablerr .card-header,.rtableov .card-header,.rtablemp .card-header{
  background-color: rgba(255,89,0,0.5);
  
  color: black;
}
th,tr{
  text-align: center;
}

.table-hover tbody tr:hover td, .table-hover tbody tr:hover th {
  background-color: rgba(255,89,0,0.7);
  color: white;
}
@media only screen and (min-width: 1597px) {

  #desktop_dashboard .container-fluid {

width: 80%;
background-color: #eee;
display: grid;

gap:15px ;
grid-template-columns: repeat(4, 1fr);
grid-template-rows: repeat(.5fr, 1.5fr,1.5fr,.5fr);



}

  #resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
margin-top: 50px;
}
  #chartdiv{
    width: 100%; height: 60%; display: flex-box;
    
    justify-content: center; /* center horizontal */
    align-items: center; /* center vertical */
    overflow: hidden;
  }
  #mobile_dashboard,#hidden1,#hidden2,#hidden3,#hidden4,#hidden5,#hidden6,#hidden7{
  display: none;
 }
}
@media only screen and (max-width: 1597px) {
  #desktop_dashboard .container-fluid {

width: 80%;
background-color: #eee;
display: grid;

gap:15px ;
grid-template-columns: repeat(4, 1fr);
grid-template-rows: repeat(.5fr, 1.5fr,1.5fr,.5fr);



}
  #resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
margin-top: 30px;
}
  th, tr{
  text-align: center;
  font-size: 12px;
}
#resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
  width: 150px;
  font-size: 12px;
}
#chartdiv{
  width: 100%;
   height: 45%;
    display: flexbox;
    
    justify-content: center; /* center horizontal */
    align-items: center; /* center vertical */
    overflow: hidden;
}
.text p,.font_awesome{
   font-size: 16px; 
  }
  #mobile_dashboard,#hidden1,#hidden2,#hidden3,#hidden4,#hidden5,#hidden6,#hidden7{
  display: none;
 }
}
@media only screen and (max-width: 1244px) {
  #desktop_dashboard .container-fluid {

width: 90%;
background-color: #eee;
display: grid;

gap:15px ;
grid-template-columns: repeat(4, 1fr);
grid-template-rows: repeat(.5fr, 1.5fr,1.5fr,.5fr);



}
  #resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
margin-top: 10px;
}
  th, tr{
  text-align: center;
  font-size: 10px;
}
#resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
  width: 110px;
  font-size: 10px;
}
.text p,.font_awesome{
   font-size: 14px; 
  }
  #mobile_dashboard,#hidden1,#hidden2,#hidden3,#hidden4,#hidden5,#hidden6,#hidden7{
  display: none;
 }
}
@media only screen and (max-width: 1000px) {
  #desktop_dashboard .container-fluid {

width: 100%;
background-color: #eee;
display: grid;

gap:15px ;
grid-template-columns: repeat(4, 1fr);
grid-template-rows: repeat(.5fr, 1.5fr,1.5fr,.5fr);



}
  th, tr{
  text-align: center;
  font-size: 10px;
}
#resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
  width: 110px;
 
  font-size: 10px;
}
.text p,.font_awesome{
   font-size: 10px; 
  }
  #mobile_dashboard,#hidden1,#hidden2,#hidden3,#hidden4,#hidden5,#hidden6,#hidden7{
  display: none;
 }
}


@media only screen and (max-width: 830px) {
    #desktop_dashboard {
        display: none;
    }
    #mobile_dashboard{
      display: block;
    }
    #desktop_dashboard .container-fluid {

width: 80%;
background-color: #eee;
display: grid;

gap:15px ;
grid-template-columns: repeat(4, 1fr);
grid-template-rows: repeat(.5fr, 1.5fr,1.5fr,.5fr);



}

  .goback,#resistanceButton,#otherButton,#missingButton,#showButton,#seeButton{
width: auto;
height: auto;
}
  #chartdiv{
    width: 100%; height: 60%; display: flex-box;
    
    justify-content: center; /* center horizontal */
    align-items: center; /* center vertical */
    overflow: hidden;
  }
  
}

#mobile_dashboard .col-md-12{
  background-color: rgb(74,74,74);
  color: white;
  margin-bottom: 5px;
  margin-top: 5px;
}
#mobile_dashboard .row{
  background-color: rgb(74,74,74)
}
#mobile_dashboard  .container-fluid{
  background-color: #eee;
  width: 100%;
}
#mobile_dashboard .col-md-12:hover{
  background-color: rgb(255,89,0);
  
  border-radius: 10px;
  cursor: pointer;
  --x: 50%;
	--y: 50%;
  border: 2px solid transparent;
	background: linear-gradient(rgb(255,89,0),rgb(255,89,0)) padding-box, radial-gradient(farthest-corner at var(--x) var(--y), #ddecea, #e29f75) border-box;
}
.font_awesome{
  display:inline-block;
    
    text-align: center;
    vertical-align: bottom;
}
 
  </style>
  

  
</head>
<section id="desktop_dashboard">
<div class="container-fluid" id="changeable" style="margin-top: 25px;">
  <div class="1">
    <h4><b>RESULT ID: </b> {{run_id}}</h4>
    <div class="date">
      {% for key in tables %}
      {% if key == 'General information' %}
      {{macros.get_results2(tables[key][0], tables[key][1], key)}}
      
      {% endif %}
      {% endfor %}              
    </div>
    <div class="id">
      <form method="get" action="{{ url_for('main.download', run_id=run_id) }}">          
      </div>
      
  </div>
  
  <div class="2">
    <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
      <h4>Species</h4>
    </div>
    {% for key in tables %}
    {% if key == 'Species' %}
    {{macros.get_results(tables[key][0], tables[key][1], key)}}
    
    {% endif %}
    {% endfor %}                 
  </div>
  <div class="3" id="three">
    <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
      <h4>Genomic variants</h4>
    </div>
      <div class="tabby" id="remove1">    
        <div class="tab-content" id="tabcontent">  
          
          {% for key in tables %}     
                {% if key == "Resistance report" %}
                <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                </div>       
            
                
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="tabby" id="remove2" style="display:none;">    
        <div class="tab-content" id="tabcontent">  
          
          {% for key in tables %}     
                {% if key == "Other variants" %}
                <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                </div>       
            
              
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="tabby" id="remove3" style="display:none;">    
        <div class="tab-content" id="tabcontent">  
          
          {% for key in tables %}     
                {% if key == "Missing positions report" %}
                <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                </div>       
            
                
            {% endif %}
          {% endfor %}
        </div>
      </div>
      
        <div class="buttons">
        <span style="display: table;
        margin: 0 auto;">
        {% set values = [] %}

        {% for key in tables %}
    
    {% for row in tables[key][0] %}
    {% if key == 'Resistance variants report' %}
    {{ values.append(row) or "" }}
   {% endif %}
    {% endfor %}
        
{% endfor %}
<meta id="rvr-data" data-name="{{values}}" >
         <a  class="orange btn btn-outline-success btn-lg active" id="resistanceButton" onclick="showDiv('remove1')">RESISTANCE REPORT</a>
       
         {% set values = [] %}
    
         {% for key in tables %}
    
    {% for row in tables[key][0] %}
    {% if key == 'Other variants' %}
    {{ values.append(row) or "" }}
   {% endif %}
    {% endfor %}
        
{% endfor %}
        <meta id="other-data" data-name="{{values}}" >
         <a  class="orange btn btn-outline-success btn-lg"  id="otherButton" onclick="showDiv('remove2')">OTHER VARIANTS</a>
         
         {% set values = [] %}
  
        {% for key in tables %}
    
        {% for row in tables[key][0] %}
        {% if key == 'Missing positions report' %}
        {{ values.append(row) or "" }}
       {% endif %}
        {% endfor %}
            
    {% endfor %}
    <meta id="miss-data" data-name="{{values}}" >
         <a  class="orange btn btn-outline-success btn-lg" id="missingButton" onclick="showDiv('remove3')">MISSING POSITIONS</a>
        </span>
        </div>
        <div class="moreButtons">
          <span style="display: table;
        margin: 0 auto;">
          <a  data-toggle="modal" data-target=".bd-example-modal-lg" class=" btn btn-outline-success btn-lg" style="margin-top: 10px;" id="showButton">SHOW MORE INFO</a>
          </span>
        </div>
       
        <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
               <div class="tabb"  >    
                <div class="tab-content" id="tabcontent"> 
                  {% for key in tables %}     
                  {% if key == "Resistance variants report" %}
                  <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.resistanceTable1(tables[key][0], tables[key][1], key)}}
                </div> 
                {% elif key == "Other variants" %}
                <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.resistanceTable2(tables[key][0], tables[key][1], key)}}
                </div> 
                {% elif key == "Missing positions report" %}
                <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                  {{macros.resistanceTable3(tables[key][0], tables[key][1], key)}}
                </div> 
                {% endif %}
                {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>   
      
  </div>
  <div class="4">
    <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
      <h4>Estimated Region of Origin</h4>
  </div>
  {% for key in tables %}
    
    {% for row in tables[key][0] %}
    {% if key == 'Geoclassification' %}
    <meta id="region" data-name="{{row}}" >
    <p style="text-align: center; margin-top: 5px; font-family: 'Sofia Sans', sans-serif;">{{row['region']}}</p>
    {% endif %}
    {% endfor %}
    {% endfor %}
    <div id="chartdiv" ></div></div>
  <div class="5">
    <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
      <h4>Analysis</h4>
    </div>
    {% for key in tables %}
    {% if key == 'Analysis' %}
    {{macros.get_results(tables[key][0], tables[key][1], key)}}
    
    {% endif %}
    {% endfor %}  
  </div>
  <div class="6">
    <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
      <h4>Coverage report</h4>
    </div>
    <div class="carousel">
      {% for key in tables %}
    {% if key == 'Coverage report' %}
    {{macros.get_analysis(tables[key][0], tables[key][1], key)}}
    
    {% endif %}
    {% endfor %}
    </div>
    <div class="buttonhere">
      <span style="display: table;
      margin: 0 auto; margin-bottom: 10px;">
      <a  class="btn btn-outline-success btn-lg " id="seeButton" data-toggle="modal" data-target=".bd-modal-lg"
      >SEE ALL</a>
      </span>
    </div>
    <div class="modal fade bd-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
           <div class="tabb"  >    
            <div class="tab-content" id="tabcontent" style="text-align: left;"> 
              {% for key in tables %}     
            {% if key == "Coverage report" %}
            <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
              {{macros.generic_table(tables[key][0], tables[key][1], key)}}
            </div> 
            {% endif %}
            {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>   
    </div>
  <div  class="7" id="7"> 

    <div class="igvDiv" id="igvDiv" style="width: 100%; height:auto; overflow: hidden; border-radius: 25px;"></div>
</div>

   
</div>


<section class="button" style="margin-top:50px">
  <div class="container" id="buttonbit">
    <div class="buttonHere">
      <button type="submit" class="btn btn-success btn" name="result_download" id="result_download"><i class="fa fa-download"></i> DOWNLOAD</button>
    </div>
  </div>
  
</section>
</section>
&nbsp;
&nbsp;
<section id="mobile_dashboard" style="height: 100vh; background-color: rgb(74,74,74);">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12" onclick="showHidden('#hidden1')">
        <h4>
          RESULT ID
        </h4>
      </div>
      <div class="col-md-12"onclick="showHidden('#hidden2')">
        <h4>
          SPECIES
        </h4>
      </div>
      <div class="col-md-12"onclick="showHidden('#hidden3')">
        <h4>
          GENOMIC VARIANTS
        </h4>
      </div>
      <div class="col-md-12"onclick="showHidden('#hidden4')">
        <h4>
          ESTIMATED ORIGIN OF REGION
        </h4>
      </div>
      <div class="col-md-12"onclick="showHidden('#hidden5')">
        <h4>
          ANALYSIS
        </h4>
      </div>
      <div class="col-md-12"onclick="showHidden('#hidden6')">
        <h4>
          COVERAGE REPORT
        </h4>
      </div>
      <div class="col-md-12" onclick="showHidden('#hidden7')">
        <h4>
          SHOW MORE INFO
        </h4>
      </div>
    </div>
  </div>
</section>

<section class="hiddenbit" id="hidden1" >
  <div class="container-fluid">
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="1">
          <h4><b>RESULT ID: </b> {{run_id}}</h4>
          <div class="date">
            {% for key in tables %}
            {% if key == 'General information' %}
            {{macros.get_results2(tables[key][0], tables[key][1], key)}}
            
            {% endif %}
            {% endfor %}              
          </div>
          <div class="id">
            <form method="get" action="{{ url_for('main.download', run_id=run_id) }}">          
            </div>
            
        </div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden1')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>
</section>
<section class="hiddenbit" id="hidden2" >
  <div class="container-fluid" >
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="2">
          <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
            <h4>Species</h4>
          </div>
          {% for key in tables %}
          {% if key == 'Species' %}
          {{macros.get_results(tables[key][0], tables[key][1], key)}}
          
          {% endif %}
          {% endfor %}                 
        </div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden2')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>

</section>

<section class="hiddenbit" id="hidden3" >
  <div class="container-fluid" >
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="tree">
          <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
            <h4>Genomic variants</h4>
          </div>
            <div class="tabby" id="md-remove1">    
              <div class="tab-content" id="tabcontent">  
                
                {% for key in tables %}     
                      {% if key == "Resistance report" %}
                      <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                        {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                      </div>       
                  
                      
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            <div class="tabby" id="md-remove2" style="display:none;">    
              <div class="tab-content" id="tabcontent">  
                
                {% for key in tables %}     
                      {% if key == "Other variants" %}
                      <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                        {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                      </div>       
                  
                    
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            <div class="tabby" id="md-remove3" style="display:none;">    
              <div class="tab-content" id="tabcontent">  
                
                {% for key in tables %}     
                      {% if key == "Missing positions report" %}
                      <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                        {{macros.generic_table(tables[key][0], tables[key][1], key)}}
                      </div>       
                  
                      
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            
              <div class="buttons" style="margin-top:100px;">
              <span style="display: table;
              margin: 0 auto;">
              {% set values = [] %}
      
              {% for key in tables %}
          
          {% for row in tables[key][0] %}
          {% if key == 'Resistance variants report' %}
          {{ values.append(row) or "" }}
         {% endif %}
          {% endfor %}
              
      {% endfor %}
      <meta id="rvr-data" data-name="{{values}}" >
               <a  class="orange btn btn-outline-success btn-lg active" id="resistanceButton" onclick="showDiv('md-remove1')">RESISTANCE REPORT</a>
             
               {% set values = [] %}
          
               {% for key in tables %}
          
          {% for row in tables[key][0] %}
          {% if key == 'Other variants' %}
          {{ values.append(row) or "" }}
         {% endif %}
          {% endfor %}
              
      {% endfor %}
              <meta id="other-data" data-name="{{values}}" >
               <a  class="orange btn btn-outline-success btn-lg"  id="otherButton" onclick="showDiv('md-remove2')">OTHER VARIANTS</a>
               
               {% set values = [] %}
        
              {% for key in tables %}
          
              {% for row in tables[key][0] %}
              {% if key == 'Missing positions report' %}
              {{ values.append(row) or "" }}
             {% endif %}
              {% endfor %}
                  
          {% endfor %}
          <meta id="miss-data" data-name="{{values}}" >
               <a  class="orange btn btn-outline-success btn-lg" id="missingButton" onclick="showDiv('md-remove3')">MISSING POSITIONS</a>
              </span>
              </div>
              
             
              <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                     <div class="tabb"  >    
                      <div class="tab-content" id="tabcontent"> 
                        {% for key in tables %}     
                        {% if key == "Resistance variants report" %}
                        <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                        {{macros.resistanceTable1(tables[key][0], tables[key][1], key)}}
                      </div> 
                      {% elif key == "Other variants" %}
                      <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                        {{macros.resistanceTable2(tables[key][0], tables[key][1], key)}}
                      </div> 
                      {% elif key == "Missing positions report" %}
                      <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                        {{macros.resistanceTable3(tables[key][0], tables[key][1], key)}}
                      </div> 
                      {% endif %}
                      {% endfor %}
                      </div>
                    </div>
                  </div>
                </div>
              </div>   
            
        </div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden3')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>

</section>

<section class="hiddenbit" id="hidden4" >
  <div class="container-fluid" >
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="4">
          <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
            <h4>Estimated Region of Origin</h4>
        </div>
        {% for key in tables %}
          
          {% for row in tables[key][0] %}
          {% if key == 'Geoclassification' %}
          <meta id="region" data-name="{{row}}" >
          <p style="text-align: center; margin-top: 5px; font-family: 'Sofia Sans', sans-serif;">{{row['region']}}</p>
          {% endif %}
          {% endfor %}
          {% endfor %}
          <div id="chartdiv" ></div></div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden4')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>

</section>

<section class="hiddenbit" id="hidden5" >
  <div class="container-fluid" >
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="2">
          <div class="5">
            <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
              <h4>Analysis</h4>
            </div>
            {% for key in tables %}
            {% if key == 'Analysis' %}
            {{macros.get_results(tables[key][0], tables[key][1], key)}}
            
            {% endif %}
            {% endfor %}  
          </div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden5')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>

</section>

<section class="hiddenbit" id="hidden6" >
  <div class="container-fluid" >
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="6">
          <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
            <h4>Coverage report</h4>
          </div>
          <div class="carousel">
            {% for key in tables %}
          {% if key == 'Coverage report' %}
          {{macros.generic_table(tables[key][0], tables[key][1], key)}}
          
          {% endif %}
          {% endfor %}
          </div>
             
          </div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden6')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>

</section>

<section class="hiddenbit" id="hidden7" >
  <div class="container-fluid" >
    <div class="row" style="height: 100vh;">
      <div class="col-md-12">
        <div class="2">
          <div class="card-header text-center bg-light" style="border-top-left-radius: 15px;border-top-right-radius: 15px;">
            <h4>Species</h4>
          </div>
          {% for key in tables %}
          {% if key == 'Species' %}
          {{macros.get_results(tables[key][0], tables[key][1], key)}}
          
          {% endif %}
          {% endfor %}                 
        </div>
        <div class="goback">
          <span  style="display: table; margin: 0 auto;" >
          <a  class="btn btn-outline-success btn-lg" id="goback" style="display: table-cell;" onclick="showMobile('#hidden7')">BACK</a>
          </span>
        </div>
      </div>

    </div>

  </div>

</section>


<script type="text/javascript">
  
  function showHidden(div){
    $(div).slideDown(1000);

    $("#mobile_dashboard").slideUp(1000);
  }
  function showMobile(div){
    $("#mobile_dashboard").slideDown(1000);
    $(div).slideUp(1000);
  
    
  }
</script>

<script type="text/javascript">
$( document ).ready(function() {
  var w = window.innerWidth;
var h = window.innerHeight; 
console.log(w,h)



});
  function showDiv(divId) {
    var divs = document.getElementsByClassName("tabby");
    for (var i = 0; i < divs.length; i++) {
        divs[i].style.display = "none";
    }
    document.getElementById(divId).style.display = "block";
}
  function showGene2(number,dataN) {
   
    var gene = document.getElementById("dropdownMenu"+number).parentNode.querySelector("[data-keyz]").getAttribute("data-keyz");
      var protein = document.getElementById("dropdownMenu"+number).innerText  
  
      changeData(dataN,gene,protein)
      
  }
  
  function showGene(item,number) {
    
document.getElementById("dropdownMenu"+number).innerHTML = item.innerHTML;

    
}
  
function changeData(data,gene,protein){

  igv.removeAllBrowsers()
  STATIC_URL = 'static/'
  {# {% load static %} #}

  var djangoData = $(data).data();


  
  var rvrValues = Object.values(djangoData);
  var splitvalues = []
  firstValue = rvrValues[0]
  if( data=='#rvr-data' || data=='#other-data' ){
splitValues = firstValue.split("{'chrom':")
  }else{
splitValues = firstValue.split("{")

  }
var nucleotideArray = []
var chromArray = []
var resistancePosArray = []

for(var i =1; i<splitValues.length;i++){

  var split2 =splitValues[i].split(",")
  
  if(split2.find(a =>a.includes(gene))){
  
    
    if(data == '#rvr-data'){
      
      chromArray.push(split2[0].split("_")[1])
    resistancePosArray.push(split2[1].split(":")[1])
      var curr = split2[12].split(":")[1]
    curr = curr.replace(/['"]+/g, '').trim();
   
    nucleotideArray.push(curr)
    }else if(data == '#other-data'){
     
      chromArray.push(split2[0].split("_")[1])
    resistancePosArray.push(split2[1].split(":")[1])
      var curr = split2[11].split(":")[1]
    curr = curr.replace(/['"]+/g, '').trim();
   
    nucleotideArray.push(curr)
    }else{
     
      var tempArray = split2[1].split(":")[1]
      
      console.log(tempArray)
      var tempVar = tempArray.split("_")[1];
      chromArray.push(tempVar.slice(0,2))      
    resistancePosArray.push(split2[0].split(":")[1])
      var curr = split2[3].split(":")[1]
    curr = curr.replace(/['"]+/g, '').trim();
   
    nucleotideArray.push(curr)
    }
  }
  }
  proteins = protein.trim();
  function getAllIndexes(arr, val) {
    var indexes = [], i = -1;
    while ((i = arr.indexOf(val, i+1)) != -1){
        indexes.push(i);
    }
    return indexes;
}
var currentChromosome = "";
var currentPos = "";
var currIndex = nucleotideArray.indexOf(proteins)
  if( data=='#rvr-data' || data=='#other-data' ){
    currentPos = resistancePosArray[currIndex]
  }else{
    var indexes = getAllIndexes(nucleotideArray, proteins);

    tempChr = []
  for (var i = 0; i < indexes.length; i++) {
    tempChr.push(resistancePosArray[indexes[i]])
}
    firstPos = tempChr[0];
    lastPos = tempChr[tempChr.length-1];  
    
  }
  currentChromosome = chromArray[currIndex]
if (currentChromosome.includes("0")){
  currentChromosome = currentChromosome.replace('0','')
}else{

}
var initiallocus = ""
if( data=='#rvr-data' || data=='#other-data' ){
   initiallocus = "chr"+currentChromosome+":"+currentPos

  }else{
   initiallocus = "chr"+currentChromosome+":"+firstPos+"-"+lastPos
   
  }
  var locus = initiallocus.replace(/\s+/g, '')
console.log(locus)
var igvDiv = document.getElementById("igvDiv");
      var options =
        {
          genome:"hg38",
            locus: locus,
            tracks: [
                {
                    "name": gene,
                    "url": "https://s3.amazonaws.com/1000genomes/data/HG00103/alignment/HG00103.alt_bwamem_GRCh38DH.20150718.GBR.low_coverage.cram",
                    "indexURL": "https://s3.amazonaws.com/1000genomes/data/HG00103/alignment/HG00103.alt_bwamem_GRCh38DH.20150718.GBR.low_coverage.cram.crai",
                    "height":"50"
                }
            ]
        };
        igv.createBrowser(igvDiv, options)
                .then(function (browser) {
                })
    }

            


</script>




<script  type=text/javascript>
  $('.orange').click(function(e) {
    e.preventDefault();
  
  $('.orange').removeClass('active');
  $(this).addClass('active');
})
</script>
<script>
  
</script>
<!--
  <div class="row justify-content-center text-center">
    <div class="col-md-6">
      <h4><b>Result ID:</b> {{run_id}}</h4>
        <div id="f3" class="row justify-content-center">
          <form method="get" action="{{ url_for('main.download', run_id=run_id) }}">          
          <button type="submit" class="btn btn-success btn-lg" name="result_download" id="result_download"><i class="fa fa-download"></i> Download</button>
          </form>
        </div>
        <hr>  
    </div>
  </div class="row justify-content-center text-center">
  
  <div class="row justify-content-center text-center">
    <div class="col-md-6">
      <ul class="nav nav-tabs" id="nav-tab" role="tablist">
        {% for key in tables %}
          {% if tables[key] != None %}
            {% set keyname = key.replace(' ', '') %}
              <li class="nav-item" role="presentation">
                {% if loop.index0 == 0 %}                    
                  <a class="nav-link active" id="{{ keyname }}-tab" data-toggle="tab" href="#{{ keyname }}-tabs" role="tab" aria-controls="{{ keyname }}-tabs" aria-selected="true">{{key}}</a>
                {% else %}
                  <a class="nav-link" id="{{ keyname }}-tab" data-toggle="tab" href="#{{ keyname }}-tabs" role="tab" aria-controls="{{ keyname }}-tabs" aria-selected="false">{{key}}</a>
                {% endif %}
              </li>
          {% endif %}            
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="row justify-content-center text-center">
    <div class="col-md-6">    
      <div class="tab-content" id="tabcontent">  
        {% for key in tables %}     
          {% if tables[key] != None %}         
            {% set keyname = key.replace(' ', '') %}
            {% if loop.index0 == 0 %}  
              <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                {{macros.generic_table(tables[key][0], tables[key][1], key)}}
              </div>       
            {% elif loop.index0 != 0 %}
            <div class="tab-pane fade" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                {{macros.generic_table(tables[key][0], tables[key][1], key)}}
              </div>  
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>    
  </div>
  
{% elif status == "Processing" %}
  <div class="row justify-content-center">
    <div class="loader"></div>
  </div>
  <div class="row justify-content-center">
    <h4 id="resultid">{{run_id}}</h4>

  -->
  
  <script>

    setTimeout(function(){
        window.location.reload(1);
    }, 5000);
  </script> 

{% endif %}
{% endblock %}