{% import 'macros.html' as macros %}
{% extends "base.html" %}
{% block header %}
{% endblock %}
{% block content %}
{% if status == "OK" %}
  <div class="row justify-content-center text-center">
    <div class="col-md-6">
        <h4><b>Result ID:</b> {{run_id}}</h4>
        <div id="f3" class="row justify-content-center">
          <form method="get" action="{{ url_for('main.download', run_id=run_id) }}">          
          <button type="submit" class="btn btn-success btn-lg" name="result_download" id="result_download"><i class="fa fa-download"></i> Download</button>
          </form>
        </div>
        <hr>  
    </div>
  </div class="row justify-content-center text-center">
  
  <div class="row justify-content-center text-center">
    <div class="col-md-6">
      <ul class="nav nav-tabs" id="nav-tab" role="tablist">
        {% for key in tables %}
          {% if tables[key] != None %}
            {% set keyname = key.replace(' ', '') %}
              <li class="nav-item" role="presentation">
                {% if loop.index0 == 0 %}                    
                  <a class="nav-link active" id="{{ keyname }}-tab" data-toggle="tab" href="#{{ keyname }}-tabs" role="tab" aria-controls="{{ keyname }}-tabs" aria-selected="true">{{key}}</a>
                {% else %}
                  <a class="nav-link" id="{{ keyname }}-tab" data-toggle="tab" href="#{{ keyname }}-tabs" role="tab" aria-controls="{{ keyname }}-tabs" aria-selected="false">{{key}}</a>
                {% endif %}
              </li>
          {% endif %}            
        {% endfor %}
      </ul>
    </div>
  </div>

  <div class="row justify-content-center text-center">
    <div class="col-md-6">    
      <div class="tab-content" id="tabcontent">  
        {% for key in tables %}     
          {% if tables[key] != None %}         
            {% set keyname = key.replace(' ', '') %}
            {% if loop.index0 == 0 %}  
              <div class="tab-pane fade show active" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                {{macros.generic_table(tables[key][0], tables[key][1], key)}}
              </div>       
            {% elif loop.index0 != 0 %}
            <div class="tab-pane fade" id="{{ keyname }}-tabs" role="tabpanel" aria-labelledby="{{ keyname }}-tab">
                {{macros.generic_table(tables[key][0], tables[key][1], key)}}
              </div>  
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>
    </div>    
  </div>
{% elif status == "Processing" %}
  <div class="row justify-content-center">
    <div class="loader"></div>
  </div>
  <div class="row justify-content-center">
    <h4 id="resultid">{{run_id}}</h4>
    <script>
     function copyToClipboard(element) {
        var $temp = $("<input>");
        $("body").append($temp);
        $temp.val($(element).text()).select();
        document.execCommand("copy");
        $temp.remove();
      }
    </script>    
  </div>
  <div class="row justify-content-center">     
    <button class="btn btn-outline-secondary" onclick="copyToClipboard('#resultid')">Copy Result ID</button>
  </div>
  <script>
    setTimeout(function(){
        window.location.reload(1);
    }, 5000);
  </script>

{% endif %}
{% endblock %}